{% extends "base.html" %}

{% block content %}
<h1 class="text-2xl font-bold mb-4">Active Alerts</h1>

<div class="bg-white p-4 rounded shadow">
    <table class="w-full text-left border-collapse">
        <thead>
            <tr class="border-b">
                <th class="p-2">Document</th>
                <th class="p-2">Rule</th>
                <th class="p-2">Severity</th>
                <th class="p-2">Description</th>
                <th class="p-2">Action</th>
            </tr>
        </thead>
        <tbody id="alert-body"></tbody>
    </table>
</div>

<script>
function loadAlerts() {
    fetch("/api/alerts/")
        .then(res => res.json())
        .then(data => {
            const tbody = document.getElementById("alert-body");
            tbody.innerHTML = "";

            data.forEach(item => {
                tbody.innerHTML += `
                    <tr class="border-b">
                        <td class="p-2">${item.document.name}</td>
                        <td class="p-2">${item.rule}</td>
                        <td class="p-2">
                            <span class="text-red-600 font-semibold">${item.severity}</span>
                        </td>
                        <td class="p-2">${item.description}</td>
                        <td class="p-2">
                            <button onclick="resolve(${item.id})"
                                class="bg-blue-600 text-white px-3 py-1 rounded">
                                    Resolve
                            </button>
                        </td>
                    </tr>
                `;
            });
        });
}

function resolve(id) {
    fetch(`/api/alerts/${id}/resolve/`, {
        method: "POST",
    }).then(() => loadAlerts());
}

// Auto-refresh every 10 seconds
setInterval(loadAlerts, 10000);
loadAlerts();
</script>

{% endblock %}
